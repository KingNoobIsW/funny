<!DOCTYPE html>
<html>
<head>
    <title>Popup Window</title>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: black;
        }

        #box {
            width: 150px;
            height: 150px;
            background: red;
            position: absolute;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
            font-family: Arial, Helvetica, sans-serif;
            transition: background 0.15s;
        }
    </style>
</head>
<body>

<div id="box">HELLO!</div>

<audio id="beep" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

<script>
let box = document.getElementById("box");
let sound = document.getElementById("beep");

let x = 50;
let y = 50;
let dx = 3;
let dy = 3;

// Bounce + flash + sound
setInterval(() => {
    let w = window.innerWidth;
    let h = window.innerHeight;

    x += dx;
    y += dy;

    if (x <= 0 || x + 150 >= w) {
        dx *= -1;
        sound.play();
        box.style.background = randomColor();
    }

    if (y <= 0 || y + 150 >= h) {
        dy *= -1;
        sound.play();
        box.style.background = randomColor();
    }

    box.style.transform = `translate(${x}px, ${y}px)`;
}, 20);

function randomColor() {
    return `hsl(${Math.random() * 360}, 100%, 50%)`;
}

// Anti-close
document.addEventListener("mousemove", (e) => {
    let distX = window.innerWidth - e.clientX;
    let distY = e.clientY;

    if (distX < 120 && distY < 80) {
        x = Math.random() * (window.innerWidth - 200);
        y = Math.random() * (window.innerHeight - 200);
        sound.play();
    }
});

// MAIN WINDOW can send message to force-close
window.addEventListener("message", (event) => {
    if (event.data === "closeNow") {
        window.close();
    }
});
</script>

</body>
</html>
