<!DOCTYPE html>
<html>
<head>
    <title>Popup Window</title>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: black;
        }

        #box {
            width: 150px;
            height: 150px;
            background: red;
            position: absolute;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
            font-family: Arial, Helvetica, sans-serif;
            text-align: center;
            padding: 10px;
            transition: background 0.15s;
        }
    </style>
</head>
<body>

<div id="box">HELLO!</div>

<audio id="beep" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

<script>
let box = document.getElementById("box");
let sound = document.getElementById("beep");

let x = 50;
let y = 50;
let dx = 3;
let dy = 3;

// Shared communication channel for all popups
const channel = new BroadcastChannel("popupTalk");

// Annoying messages for talking
const annoyingLines = [
    "ez gg no re",
    "STOP TRYING TO CLOSE ME!",
    "your balls lwk",
    "YOU CANâ€™T GET RID OF ME!",
    "i verified cols",
    "I",
    "CLICK THE X",
    "WHY",
    "taking your data trust",
    "hello im unc",
    "dih",
    "ez ez ez ez ez ez ez ez",
    "hi",
    ":D",
];

// Replies to another popup's message
const replyLines = [
    "but why",
    "hello im unc",
    "ez",
    "ragebait",
    "your so niche boiii",
    "ez",
    "dih",
    "tuff boiiiiiiiii mango mango labubu lets steal a 67",
];

// Speak out loud
function speak(text) {
    try {
        let utter = new SpeechSynthesisUtterance(text);
        utter.pitch = 1.2;
        utter.rate = 1.1;
        window.speechSynthesis.speak(utter);
    } catch (err) {}
}

// Random color
function randomColor() {
    return `hsl(${Math.random() * 360}, 100%, 50%)`;
}

// Send message to other popups
function broadcast(text) {
    channel.postMessage({ msg: text });
}

// Popup talks by itself every few seconds
function startTalking() {
    setInterval(() => {
        let msg = annoyingLines[Math.floor(Math.random() * annoyingLines.length)];
        box.innerText = msg;
        speak(msg);
        broadcast(msg);
    }, Math.random() * 3000 + 3000);
}
startTalking();

// Respond to messages from other popups
channel.onmessage = (event) => {
    if (!event.data.msg) return;

    setTimeout(() => {
        let reply = replyLines[Math.floor(Math.random() * replyLines.length)];
        box.innerText = reply;
        speak(reply);
    }, Math.random() * 1200 + 400);
};

// Bouncing + flash + sound
setInterval(() => {
    let w = window.innerWidth;
    let h = window.innerHeight;

    x += dx;
    y += dy;

    if (x <= 0 || x + 150 >= w) {
        dx *= -1;
        sound.play();
        box.style.background = randomColor();
    }

    if (y <= 0 || y + 150 >= h) {
        dy *= -1;
        sound.play();
        box.style.background = randomColor();
    }

    box.style.transform = `translate(${x}px, ${y}px)`;
}, 20);

// Anti-close movement
document.addEventListener("mousemove", (e) => {
    let distX = window.innerWidth - e.clientX;
    let distY = e.clientY;

    if (distX < 120 && distY < 80) {
        x = Math.random() * (window.innerWidth - 200);
        y = Math.random() * (window.innerHeight - 200);
        sound.play();

        let msg = "NOPE! CAN'T CLOSE ME!";
        box.innerText = msg;
        speak(msg);
        broadcast(msg);
    }
});

// Close message from main window
window.addEventListener("message", (event) => {
    if (event.data === "closeNow") {
        window.close();
    }
});
</script>

</body>
</html>
